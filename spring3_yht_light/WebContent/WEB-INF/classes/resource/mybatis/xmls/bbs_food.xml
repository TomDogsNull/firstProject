<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Food">

<select id="getFoodList" parameterType="org.yht.domain.test01.FoodParam" resultType="org.yht.domain.test01.FoodVo">
	SELECT FOOD_SEQ, ID, TITLE, TOTAL_CNT, JOIN_CNT,
		   MEETINGDAY, CONTENT, WDATE, READ_CNT, LIKE_CNT, LOCAL 
	FROM
		(SELECT ROW_NUMBER() OVER(ORDER BY FOOD_SEQ DESC)AS RNUM,
			FOOD_SEQ, ID, TITLE, TOTAL_CNT, JOIN_CNT,
		   	MEETINGDAY, CONTENT, WDATE, READ_CNT, LIKE_CNT, LOCAL
		 FROM TEST01_FOOD 
		 WHERE 1=1 
		 <if test="f_category != null and f_category != ''
		 		and f_keyword != null and f_keyword != ''">
		 	
		 	<if test="f_category == 'title'">
		 		AND TITLE LIKE '%'||#{f_keyword}||'%'
		 	</if>
		 	<if test="f_category == 'contents'">
		 		AND CONTENT LIKE '%'||#{f_keyword}||'%'
		 	</if>
		 	<if test="f_category == 'id'">
		 		AND ID LIKE '%'||#{f_keyword}||'%'
		 	</if>
		 </if>
		) A
	WHERE RNUM BETWEEN ${start} AND ${end}
</select>

<select id="getFoodCount" parameterType="org.yht.domain.test01.FoodParam" resultType="java.lang.Integer">
	SELECT NVL(COUNT(*), 0) AS CNT
	FROM TEST01_FOOD
	WHERE 1=1
	<if test="f_category != null and f_category != ''
		 		and f_keyword != null and f_keyword != ''">
		 	
	 	<if test="f_category == 'title'">
	 		AND TITLE LIKE '%'||#{f_keyword}||'%'
	 	</if>
	 	<if test="f_category == 'contents'">
	 		AND CONTENT LIKE '%'||#{f_keyword}||'%'
	 	</if>
	 	<if test="f_category == 'id'">
		 	AND ID LIKE '%'||#{f_keyword}||'%'
		</if>
	 </if>
</select>

<insert id="writeFood" parameterType="org.yht.domain.test01.FoodVo">
	INSERT INTO TEST01_FOOD(FOOD_SEQ, ID, TITLE, TOTAL_CNT, JOIN_CNT, MEETINGDAY, CONTENT, WDATE, READ_CNT, LIKE_CNT, LOCAL)
	VALUES(SEQ_FOOD.NEXTVAL, #{id}, #{title}, #{total_cnt}, 1, #{meetingDay}, #{content}, SYSDATE, 0, 0, #{local})
</insert>

<select id="detailFood" parameterType="java.lang.Integer" resultType="org.yht.domain.test01.FoodVo">
      SELECT F.FOOD_SEQ, F.ID, F.TITLE, F.TOTAL_CNT, F.JOIN_CNT, F.MEETINGDAY, 
      		 F.CONTENT, F.WDATE, F.READ_CNT, F.LIKE_CNT, F.LOCAL , A.FULLNAME
      FROM TEST01_FOOD F, TEST01_ATTACH A
      WHERE F.FOOD_SEQ=A.FOOD_SEQ AND F.FOOD_SEQ=#{food_seq}
      ORDER BY F.FOOD_SEQ
</select>


<!--  ////파일업로드 관련////  -->

<!-- 첨부파일 목록 가져오기 -->
<select id="getAttach" parameterType="java.lang.Integer" resultType="java.lang.String">
      SELECT FULLNAME 
      FROM TEST01_ATTACH 
      WHERE FOOD_SEQ=#{food_seq} ORDER BY RDATE
</select>
	 
<!-- 첨부파일 등록 -->	
<insert id="addAttach" parameterType="org.yht.domain.test01.AttachVo">
       INSERT INTO TEST01_ATTACH(FULLNAME, FOOD_SEQ, RDATE) 
       VALUES (#{fullname}, SEQ_FOOD.CURRVAL, SYSDATE)
</insert>



</mapper>